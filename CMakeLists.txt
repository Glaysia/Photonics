cmake_minimum_required(VERSION 3.28)
project(Photonics)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

set(PHOTONICS_ENABLE_MFEM_DEFAULT ON)
if (CMAKE_CXX_STANDARD LESS 17)
    set(PHOTONICS_ENABLE_MFEM_DEFAULT OFF)
endif()
option(PHOTONICS_ENABLE_MFEM "Enable MFEM integration" ${PHOTONICS_ENABLE_MFEM_DEFAULT})

add_executable(Photonics main.cpp mylib.cpp)

target_include_directories(Photonics PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})

if (PHOTONICS_ENABLE_MFEM)
    set(MFEM_DIR "${CMAKE_CURRENT_SOURCE_DIR}/external/mfem/install-openblas/lib/cmake/mfem" CACHE PATH "Path to the MFEM package configuration")
    list(APPEND CMAKE_INSTALL_RPATH "${CMAKE_CURRENT_SOURCE_DIR}/external/mfem/install-openblas/lib" "/usr/lib/x86_64-linux-gnu")
    list(APPEND CMAKE_BUILD_RPATH "${CMAKE_CURRENT_SOURCE_DIR}/external/mfem/install-openblas/lib" "/usr/lib/x86_64-linux-gnu")
    find_package(MFEM CONFIG PATHS ${MFEM_DIR} NO_DEFAULT_PATH QUIET)
    if (MFEM_FOUND)
        target_include_directories(Photonics PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/external/mfem/install-openblas/include)
        target_link_libraries(Photonics PRIVATE mfem)
    else()
        message(STATUS "MFEM not found; build it in external/mfem/install or override -DMFEM_DIR.")
    endif()
else()
    message(STATUS "MFEM disabled (requires at least C++14). Set -DPHOTONICS_ENABLE_MFEM=ON to force.")
endif()
